tumuai/
├── .bolt/                    # Bolt配置文件夹
│   ├── config.json           # Bolt配置文件
│   └── prompt                # Prompt配置
├── .netlify/                 # Netlify配置
├── netlify/                  # Netlify Functions
│   └── functions/            # 服务端函数
│       ├── admin-actions.ts        # 管理员操作处理
│       ├── admin-categories.ts     # 分类管理处理
│       ├── admin-check.ts          # 管理员权限检查
│       ├── admin-datasets.ts       # 管理员数据集获取
│       ├── admin-stats.ts          # 管理员统计信息
│       ├── admin-tools-crud.ts     # 工具CRUD操作
│       ├── clean-duplicates.ts     # 清理重复数据
│       ├── db-repair.ts            # 数据库修复
│       ├── search-tools-optimized.ts  # 优化的工具搜索
│       ├── setup-admin.ts          # 管理员设置
│       ├── tool-detail.ts          # 工具详情获取
│       ├── tools-optimized.ts      # 优化的工具列表获取
│       ├── tools.ts                # 工具相关操作
│       └── user-favorites.ts       # 用户收藏管理
├── scripts/                  # 脚本文件夹
│   └── apply-security-patches.js   # 安全补丁应用脚本
├── src/                      # 源代码目录
│   ├── components/           # React组件
│   │   ├── AuthModal.tsx           # 认证模态框
│   │   ├── Categories.tsx          # 分类组件
│   │   ├── CategoryBrowser.tsx     # 分类浏览组件
│   │   ├── CategoryManagementModal.tsx  # 分类管理模态框
│   │   ├── DatabaseRepair.tsx      # 数据库修复组件
│   │   ├── ErrorBoundary.tsx       # 错误边界处理
│   │   ├── ErrorDisplay.tsx        # 错误显示组件
│   │   ├── FeaturedTools.tsx       # 精选工具展示
│   │   ├── Footer.tsx              # 页脚组件
│   │   ├── Header.tsx              # 头部组件
│   │   ├── Hero.tsx                # 首页英雄区域
│   │   ├── LatestTools.tsx         # 最新工具展示
│   │   ├── LoadingSpinner.tsx      # 加载指示器
│   │   ├── Newsletter.tsx          # 邮件订阅组件
│   │   ├── OptimizedImage.tsx      # 优化图片组件
│   │   ├── QuickFilters.tsx        # 快速筛选组件
│   │   ├── ToolManagementModal.tsx # 工具管理模态框
│   │   └── TypeSafeToolDetail.tsx  # 类型安全的工具详情组件
│   ├── contexts/             # React上下文
│   │   └── AuthContext.tsx         # 认证上下文
│   ├── hooks/                # 自定义React Hooks
│   │   ├── useErrorHandler.ts      # 错误处理Hook
│   │   └── useTypedAsyncOperation.ts  # 类型化异步操作Hook
│   ├── lib/                  # 工具库
│   │   ├── admin.ts                # 管理员功能
│   │   ├── api.ts                  # API调用封装
│   │   ├── auth.ts                 # 认证相关功能
│   │   ├── cache.ts                # 缓存管理
│   │   ├── community.ts            # 社区功能（收藏、评论等）
│   │   ├── performance-monitor.ts  # 性能监控
│   │   ├── performance.ts          # 性能相关
│   │   ├── storage.ts              # 存储相关功能
│   │   ├── supabase-optimized.ts   # 优化的Supabase客户端
│   │   ├── supabase.ts             # Supabase客户端
│   │   └── type-utils.ts           # 类型工具
│   ├── pages/                # 页面组件
│   │   ├── AboutPage.tsx           # 关于页面
│   │   ├── AdminDashboard.tsx      # 管理员仪表板
│   │   ├── AdminLoginPage.tsx      # 管理员登录页面
│   │   ├── DiagnosticPage.tsx      # 诊断页面
│   │   ├── FavoritesPage.tsx       # 收藏页面
│   │   ├── HomePage.tsx            # 首页
│   │   ├── ProfilePage.tsx         # 用户资料页面
│   │   ├── SubmitToolPage.tsx      # 提交工具页面
│   │   ├── ToolDetailPage.tsx      # 工具详情页面
│   │   └── ToolsPage.tsx           # 工具列表页面
│   ├── types/                # TypeScript类型定义
│   │   └── index.ts                # 项目类型定义
│   ├── App.tsx               # 应用根组件
│   ├── env.ts                # 环境变量配置
│   ├── index.css             # 全局样式
│   ├── main.tsx              # 应用入口
│   └── vite-env.d.ts         # Vite环境类型定义
├── supabase/                 # Supabase配置
│   ├── migrations/           # 数据库迁移文件
│   │   ├── 20250120_add_status_column.sql
│   │   ├── 20250120_create_storage_bucket.sql
│   │   ├── 20250123000000_fix_all_rls_issues.sql
│   │   ├── 20250817_complete_fix_verification.sql
│   │   ├── 20250817_final_categories_fix.sql
│   │   ├── 20250817_final_database_check.sql
│   │   ├── 20250817_final_fix.sql
│   │   ├── 20250817_fix_categories_and_admin.sql
│   │   ├── 20250817_fix_table_compatibility.sql
│   │   ├── 20250817_fixed_sql.sql
│   │   ├── 20250817_minimal_fix.sql
│   │   ├── 20250817_step_by_step.md
│   │   └── 20250817_urgent_fixes.sql
│   └── config.toml           # Supabase配置文件
├── tests/                    # 测试文件
│   └── e2e/                  # 端到端测试
│       └── admin.spec.ts           # 管理员功能测试
├── .env                      # 环境变量文件
├── .gitignore                # Git忽略文件配置
├── ADMIN_GUIDE.md            # 管理员操作指南
├── CLAUDE.md                 # Claude相关文档
├── MCP-TOOLS-GUIDE.md        # MCP工具指南
├── README.md                 # 项目说明文档
├── TYPESCRIPT_GUIDE.md       # TypeScript指南
├── check_data.sql            # 数据检查SQL
├── check_database.js         # 数据库检查脚本
├── current-schema.sql        # 当前数据库模式
├── database_monitoring_queries.sql  # 数据库监控查询
├── database_optimization_scripts.sql  # 数据库优化脚本
├── database_test.sql         # 数据库测试SQL
├── database-optimization-analysis.md  # 数据库优化分析
├── database-optimization-implementation-guide.md  # 数据库优化实现指南
├── database-optimization-scripts.sql  # 数据库优化脚本
├── database-optimization-summary.md   # 数据库优化总结
├── database-fix-corrected.sql         # 数据库修复脚本
├── database-monitoring.sql            # 数据库监控脚本
├── database-security-patches.sql      # 数据库安全补丁
├── direct-sql-execution.sql           # 直接SQL执行脚本
├── env.d.ts                  # 环境变量类型定义
├── eslint.config.js          # ESLint配置
├── fix-admin-permission.sql           # 修复管理员权限SQL
├── fix-admin-users-final.sql          # 修复管理员用户SQL
├── fix-reviews-relationship.sql       # 修复评论关系SQL
├── fix-user-favorites-rls.sql         # 修复用户收藏RLS SQL
├── index.html                # HTML入口文件
├── optimized_queries.sql      # 优化查询SQL
├── package.json              # 项目依赖和脚本配置
├── package-lock.json         # 依赖锁定文件
├── playwright.config.ts      # Playwright测试配置
├── postcss.config.js         # PostCSS配置
├── remote_schema.sql         # 远程数据库模式
├── repair-script.js          # 修复脚本
├── setup-env.md              # 环境设置指南
├── tailwind.config.js        # Tailwind CSS配置
├── test-database-repair.js   # 数据库修复测试脚本
├── test_community_features.js         # 社区功能测试脚本
├── tools_data.sql            # 工具数据SQL
├── tsconfig.app.json         # 应用TypeScript配置
├── tsconfig.json             # TypeScript配置
├── tsconfig.node.json        # Node.js TypeScript配置
├── vite.config.ts            # Vite配置
└── vite-optimized.config.ts  # 优化的Vite配置




## 项目概述

这是一个基于React、TypeScript和Supabase构建的土木工程AI工具导航平台。项目主要功能包括：

1. **工具展示** - 展示各类土木工程AI工具，支持分类、搜索和筛选
2. **用户系统** - 包含注册、登录、收藏等功能
3. **工具提交** - 允许用户提交新的工具
4. **管理员系统** - 提供完整的后台管理功能，包括工具审核、分类管理等
5. **性能优化** - 实现了客户端和服务端的缓存机制
6. **数据库管理** - 包含完整的数据库迁移和修复机制

项目采用了现代化的前端技术栈，包括React、Vite、Tailwind CSS，并使用Supabase作为后端服务。通过Netlify Functions实现了服务端渲染和API接口，提升了性能和安全性。

## 核心模块详细分析

### 1. 应用入口和路由 (src/main.tsx, src/App.tsx)

#### main.tsx
- 项目的入口文件，使用 React 18 的 createRoot API 渲染应用
- 引入全局样式文件 index.css
- 渲染 App 组件作为根组件

#### App.tsx
- 应用的根组件，负责整体布局和路由配置
- 使用 React Router 进行页面路由管理
- 实现了代码分割，首页和工具页直接导入，其他页面使用懒加载
- 集成认证上下文(AuthProvider)和错误边界(ErrorBoundary)
- 包含完整的页面路由配置：
  - 首页(/) - HomePage
  - 工具中心(/tools) - ToolsPage
  - 工具详情(/tools/:toolId) - ToolDetailPage
  - 提交工具(/submit) - SubmitToolPage
  - 关于页面(/about) - AboutPage
  - 个人资料(/profile) - ProfilePage
  - 收藏页面(/favorites) - FavoritesPage
  - 管理员控制台(/admin/*) - AdminDashboard
  - 管理员登录(/admin-login) - AdminLoginPage
  - 诊断页面(/diagnostic) - DiagnosticPage

### 2. 认证系统 (src/contexts/AuthContext.tsx, src/lib/auth.ts)

#### AuthContext.tsx
- 提供全局认证状态管理的 React Context
- 使用 Supabase 的 getSession 和 onAuthStateChange 监听认证状态变化
- 提供用户登出功能，包括清理本地存储中的 Supabase 相关数据
- 获取并缓存用户资料信息
- 导出 useAuth hook 供组件使用认证状态

#### lib/auth.ts
- 封装用户注册、登录、登出等认证操作
- 提供用户资料的创建、获取和更新功能
- 与 Supabase 数据库的 user_profiles 表进行交互
- 实现了完整的用户资料管理功能

### 3. 数据访问层 (src/lib/supabase.ts, src/lib/supabase-optimized.ts)

#### lib/supabase.ts
- 创建并导出 Supabase 客户端实例
- 提供基础的数据访问功能：
  - 获取工具列表(getTools)
  - 获取精选工具(getFeaturedTools)
  - 获取最新工具(getLatestTools)
  - 根据ID获取工具详情(getToolById)
  - 增加工具浏览量(incrementToolViews)
  - 搜索工具(searchTools)
  - 获取分类列表(getCategories)
- 实现了优先使用 Netlify Functions，失败后回退到直连 Supabase 的策略

#### lib/supabase-optimized.ts
- 优化版本的 Supabase 客户端，包含客户端缓存和性能监控
- 实现了 ClientCache 类用于内存缓存管理
- 提供 API 性能监控功能
- 实现了带缓存的工具获取、详情获取、浏览量增加、搜索和分类获取功能
- 提供缓存管理工具(cacheUtils)用于获取统计、清除缓存、预热缓存等操作

### 4. 页面组件

#### ToolDetailPage.tsx (工具详情页)
- 展示工具的详细信息，包括基本信息、详细介绍、截图、功能列表、用户评价等
- 实现收藏功能，允许用户收藏工具
- 提供用户评价功能，用户可以对工具进行评分和评论
- 显示相关工具推荐
- 使用工具ID从URL参数中获取并展示对应工具的详细信息

#### SubmitToolPage.tsx (工具提交页)
- 提供表单让用户提交新的工具信息
- 包含工具名称、官网、简介、详细描述、分类、功能、定价模式、Logo等字段
- 实现了表单验证和文件上传功能
- 使用 Supabase Storage 上传工具 Logo
- 提交数据到 tool_submissions 表等待管理员审核

#### AdminDashboard.tsx (管理员控制台)
- 管理员后台主界面，包含多个管理功能模块
- 提供系统概览、工具审核、工具管理、分类管理、用户管理、数据库修复等功能
- 实现了权限验证，只有管理员才能访问
- 使用标签页组织不同的管理功能
- 与 lib/admin.ts 协作实现后台管理功能

### 5. 管理功能 (src/lib/admin.ts, src/components/*.tsx)

#### lib/admin.ts
- 提供管理员相关功能的实现
- 实现了管理员权限检查、操作日志记录、系统统计获取等功能
- 提供工具提交审核、工具和分类的增删改查操作
- 实现了访问令牌管理，确保 API 调用的安全性
- 使用 Netlify Functions 作为主要的 API 调用方式

#### ToolManagementModal.tsx
- 工具管理的模态框组件
- 提供创建和编辑工具的功能
- 包含工具的所有基本信息表单
- 实现工具的删除功能

#### CategoryManagementModal.tsx
- 分类管理的模态框组件
- 提供创建和编辑分类的功能
- 包含分类的名称、描述、颜色、图标、排序等字段

#### DatabaseRepair.tsx
- 数据库修复组件
- 提供执行数据库修复和验证分类的功能
- 通过调用 Netlify Functions 实现数据库维护操作

### 6. 社区功能 (src/lib/community.ts)

#### lib/community.ts
- 实现用户社区相关功能
- 提供工具收藏、取消收藏、检查收藏状态等功能
- 实现工具评价和评论功能
- 提供评论点赞功能
- 获取工具统计信息（收藏数、评价数、平均评分等）

### 7. 存储功能 (src/lib/storage.ts)

#### lib/storage.ts
- 实现文件存储相关功能
- 提供工具 Logo 上传到 Supabase Storage 的功能
- 实现图片文件验证，确保上传的文件符合要求

### 8. API 和类型定义 (src/lib/api.ts, src/types/index.ts)

#### lib/api.ts
- 提供统一的 API 请求封装
- 实现错误处理和标准化错误信息
- 提供带重试机制的 API 请求功能

#### types/index.ts
- 定义项目中使用的所有 TypeScript 类型
- 包括工具、分类、用户、评价等数据结构的类型定义
- 提供错误处理、表单输入等相关类型

### 9. 服务端函数 (netlify/functions/*.ts)

#### tools-optimized.ts
- 优化的工具列表获取函数
- 实现了服务端缓存机制
- 提供按分类、定价、特色等条件筛选工具的功能
- 支持按不同字段排序

#### tool-detail.ts
- 工具详情获取函数
- 根据工具ID获取工具的详细信息
- 实现了适当的缓存策略

## 文件功能详细说明

### 核心配置文件

#### index.html
- HTML入口文件，定义了页面的基本结构
- 包含页面标题、meta标签和根节点
- 引入主应用脚本

#### package.json
- 项目配置文件，定义了项目依赖、脚本和元数据
- 包含开发依赖和生产依赖
- 定义构建、开发和部署脚本

#### tsconfig.json 系列
- TypeScript配置文件，定义了编译选项和项目结构
- tsconfig.json: 主配置文件
- tsconfig.app.json: 应用特定配置
- tsconfig.node.json: Node.js环境配置

#### vite.config.ts
- Vite构建工具配置文件
- 定义了构建选项、插件和路径别名
- 配置开发服务器和生产构建行为

#### tailwind.config.js
- Tailwind CSS配置文件
- 定义了主题、颜色、间距等样式变量
- 配置了Tailwind的扩展和插件

#### postcss.config.js
- PostCSS配置文件
- 配置了Tailwind CSS和其他PostCSS插件

#### src/index.css
- 全局样式文件
- 定义了基础样式、工具类和组件样式
- 包含Tailwind指令和自定义CSS

#### src/vite-env.d.ts
- Vite环境类型定义文件
- 为Vite客户端环境提供类型支持

#### src/env.ts
- 环境变量配置文件
- 定义了应用所需的环境变量类型和默认值

### 应用核心文件

#### src/main.tsx
- 应用入口文件
- 创建React根实例并渲染App组件
- 应用全局样式

#### src/App.tsx
- 应用根组件
- 配置路由和页面导航
- 集成认证上下文和错误边界
- 定义应用整体布局

#### src/contexts/AuthContext.tsx
- 认证上下文组件
- 管理用户认证状态和用户资料
- 提供登录、注册、登出功能
- 导出useAuth hook供其他组件使用

#### src/lib/auth.ts
- 认证功能实现
- 封装Supabase认证API
- 处理用户注册、登录、登出逻辑
- 管理用户资料的创建和更新

#### src/lib/supabase.ts
- Supabase客户端配置
- 提供数据访问功能
- 实现工具、分类等数据的获取和操作
- 处理API错误和重试逻辑

#### src/lib/supabase-optimized.ts
- 优化的Supabase客户端
- 实现客户端缓存机制
- 提供性能监控功能
- 优化数据获取和缓存管理

#### src/types/index.ts
- TypeScript类型定义
- 定义工具、用户、分类等核心数据结构
- 提供API响应和错误处理类型

#### src/lib/api.ts
- API请求封装
- 统一处理HTTP请求和响应
- 实现错误处理和重试机制
- 提供请求超时和取消功能

### 组件文件

#### src/components/Header.tsx
- 页面头部组件
- 包含Logo、导航菜单、搜索栏和用户菜单
- 处理响应式布局和移动端适配
- 集成认证状态显示

#### src/components/Footer.tsx
- 页面底部组件
- 包含版权信息、链接和社交媒体图标
- 提供网站相关信息展示

#### src/components/AuthModal.tsx
- 认证模态框组件
- 提供登录和注册表单
- 处理表单验证和错误显示
- 集成Supabase认证功能

#### src/components/LoadingSpinner.tsx
- 加载指示器组件
- 显示加载状态和进度信息
- 支持不同尺寸和自定义消息

#### src/components/ErrorBoundary.tsx
- 错误边界组件
- 捕获并处理React组件错误
- 提供错误显示和重试功能
- 集成开发环境错误详情显示

#### src/components/ErrorDisplay.tsx
- 错误显示组件
- 展示API错误和用户友好消息
- 提供重试和关闭功能
- 支持不同错误类型图标

### 页面文件

#### src/pages/HomePage.tsx
- 首页组件
- 整合Hero、分类浏览、精选工具等子组件
- 展示网站核心内容和功能入口

#### src/pages/ToolsPage.tsx
- 工具中心页面
- 提供工具搜索、筛选和排序功能
- 支持网格和列表视图切换
- 集成收藏和分页功能

#### src/pages/ToolDetailPage.tsx
- 工具详情页面
- 展示工具详细信息、截图和用户评价
- 提供收藏和评价功能
- 显示相关工具推荐

#### src/pages/SubmitToolPage.tsx
- 工具提交页面
- 提供工具信息提交表单
- 处理文件上传和表单验证
- 集成Supabase Storage上传功能

#### src/pages/AboutPage.tsx
- 关于我们页面
- 展示团队信息、价值观和联系方式
- 提供公司介绍和统计数据

#### src/pages/ProfilePage.tsx
- 用户资料页面
- 展示用户信息和活动记录
- 提供资料编辑和设置功能
- 集成收藏和评价管理

#### src/pages/FavoritesPage.tsx
- 收藏页面
- 展示用户收藏的工具列表
- 提供取消收藏功能
- 支持未登录状态处理

#### src/pages/AdminLoginPage.tsx
- 管理员登录页面
- 提供管理员身份验证
- 集成权限检查和登录性能监控

#### src/pages/AdminDashboard.tsx
- 管理员控制台
- 提供系统概览、工具审核、用户管理等功能
- 集成数据统计和操作日志
- 实现权限验证和数据加载

### 工具库文件

#### src/lib/admin.ts
- 管理员功能实现
- 提供工具审核、分类管理、用户管理等功能
- 集成权限验证和操作日志

#### src/lib/community.ts
- 社区功能实现
- 提供收藏、评价、评论等社交功能
- 处理用户互动和数据统计

#### src/lib/storage.ts
- 存储功能实现
- 处理文件上传和存储管理
- 集成Supabase Storage服务

#### src/lib/cache.ts
- 缓存管理实现
- 提供客户端缓存和持久化缓存功能
- 实现缓存清理和状态管理

#### src/lib/performance-monitor.ts
- 性能监控实现
- 监控页面性能指标和Web Vitals
- 提供性能数据收集和报告功能

#### src/lib/type-utils.ts
- 类型工具实现
- 提供类型安全的异步操作处理
- 实现错误处理和状态管理类型

### Hooks文件

#### src/hooks/useTypedAsyncOperation.ts
- 类型安全的异步操作Hook
- 提供数据获取、状态管理和错误处理
- 支持重试、取消和缓存功能

#### src/hooks/useErrorHandler.ts
- 错误处理Hook
- 统一处理应用错误和异常
- 提供错误状态管理和重试功能

### Netlify Functions

#### netlify/functions/admin-actions.ts
- 管理员操作处理函数
- 处理工具审核、创建、更新和删除操作
- 集成权限验证和操作日志

#### netlify/functions/admin-categories.ts
- 分类管理处理函数
- 处理分类的增删改查操作
- 集成数据验证和权限检查

#### netlify/functions/admin-check.ts
- 管理员权限检查函数
- 验证用户管理员身份
- 提供权限令牌生成和验证

#### netlify/functions/admin-datasets.ts
- 管理员数据集获取函数
- 提供用户、工具、日志等管理数据
- 集成分页和筛选功能

#### netlify/functions/admin-stats.ts
- 管理员统计信息函数
- 提供系统统计数据和指标
- 实现数据聚合和计算

#### netlify/functions/tool-detail.ts
- 工具详情获取函数
- 根据ID获取工具详细信息
- 实现服务端缓存和性能优化

#### netlify/functions/tools-optimized.ts
- 优化的工具列表获取函数
- 提供工具搜索、筛选和排序功能
- 实现服务端缓存和分页

#### netlify/functions/user-favorites.ts
- 用户收藏管理函数
- 处理收藏的增删改查操作
- 集成用户身份验证

#### netlify/functions/tools.ts
- 工具相关操作函数
- 提供基础工具数据访问功能
- 处理工具浏览量统计

#### netlify/functions/search-tools-optimized.ts
- 优化的工具搜索函数
- 提供全文搜索和高级筛选功能
- 实现搜索结果缓存和优化

#### netlify/functions/db-repair.ts
- 数据库修复函数
- 提供数据库维护和修复功能
- 处理数据一致性和完整性检查

#### netlify/functions/setup-admin.ts
- 管理员设置函数
- 初始化管理员账户和权限
- 处理管理员用户创建和配置

#### netlify/functions/clean-duplicates.ts
- 清理重复数据函数
- 检测和清理重复工具数据
- 实现数据去重和合并逻辑

#### netlify/functions/admin-tools-crud.ts
- 管理员工具CRUD操作函数
- 提供工具的完整增删改查功能
- 集成数据验证和权限检查